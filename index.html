<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Attendance Calculator</title>
  <link rel="icon" href="icon.svg" type="image/svg+xml">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

    // --- Icon Components ---
    const Calendar = ({ c = '', s = 24, sw = 2 }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={sw} strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-calendar ${c}`}> <rect width="18" height="18" x="3" y="4" rx="2" ry="2" /> <line x1="16" x2="16" y1="2" y2="6" /> <line x1="8" x2="8" y1="2" y2="6" /> <line x1="3" x2="21" y1="10" y2="10" /> </svg> );
    const Target = ({ c = '', s = 24, sw = 2 }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={sw} strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-target ${c}`}> <circle cx="12" cy="12" r="10" /> <circle cx="12" cy="12" r="6" /> <circle cx="12" cy="12" r="2" /> </svg> );
    const Sparkles = ({ c = '', s = 24, sw = 2 }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={sw} strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-sparkles ${c}`}> <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z" /> <path d="M5 3v4" /> <path d="M19 17v4" /> <path d="M3 5h4" /> <path d="M17 19h4" /> </svg> );
    const ClipboardList = ({ c = '', s = 24, sw = 2 }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={sw} strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-clipboard-list ${c}`}> <rect width="8" height="4" x="8" y="2" rx="1" ry="1" /> <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" /> <path d="M12 11h4" /> <path d="M12 16h4" /> <path d="M8 11h.01" /> <path d="M8 16h.01" /> </svg> );
    const Settings = ({ c = '', s = 24, sw = 2 }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={sw} strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-sliders-horizontal ${c}`}> <line x1="21" x2="14" y1="4" y2="4" /> <line x1="10" x2="3" y1="4" y2="4" /> <line x1="21" x2="12" y1="12" y2="12" /> <line x1="8" x2="3" y1="12" y2="12" /> <line x1="21" x2="16" y1="20" y2="20" /> <line x1="12" x2="3" y1="20" y2="20" /> <line x1="14" x2="14" y1="2" y2="6" /> <line x1="8" x2="8" y1="10" y2="14" /> <line x1="16" x2="16" y1="18" y2="22" /> </svg> );
    const ArrowUpRight = ({ c = '', s = 24, sw = 2 }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={sw} strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-arrow-up-right ${c}`}> <path d="M7 7h10v10" /> <path d="M7 17 17 7" /> </svg> );
    const ArrowDownRight = ({ c = '', s = 24, sw = 2 }) => ( <svg xmlns="http://www.w3.org/2000/svg" width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={sw} strokeLinecap="round" strokeLinejoin="round" className={`lucide lucide-arrow-down-right ${c}`}> <path d="M7 7v10h10" /> <path d="M17 7 7 17" /> </svg> );

    
    // --- THEME ENGINE ---
    const getThemeClasses = (design, isDarkMode) => {
      const themes = {
        cupertino: {
          light: {
            font: 'font-["-apple-system",_"BlinkMacSystemFont",_"Segoe_UI",_"Roboto",_"Helvetica_Neue",_"Arial",_"Noto_Sans",_sans-serif]',
            pageBg: "bg-white", 
            cardBg: "bg-white",
            cardRounding: "rounded-xl",
            cardShadow: "shadow-sm",
            headerFont: "text-4xl font-bold",
            settingsButton: "p-2 rounded-lg hover:bg-gray-200/70",
            iconStrokeWidth: 2,
            primaryText: "text-gray-900",
            secondaryText: "text-gray-600",
            secondarySubtle: "text-gray-500",
            tertiaryBg: "bg-gray-200/70",
            dividerColor: "bg-gray-200",
            inputColor: "text-gray-500",
            actionColor: "text-blue-600",
            activeSegmentBg: "bg-white",
            iconBgRed: "bg-red-100",
            iconColorRed: "text-red-600",
            iconBgGreen: "bg-green-100",
            iconColorGreen: "text-green-600",
            modalBg: "bg-white/70 backdrop-blur-xl",
            modalRounding: "rounded-t-xl",
            modalShadow: "shadow-lg",
            modalOpenAnimation: "animate-slide-up-cupertino",
            modalCloseAnimation: "animate-slide-down-cupertino",
            backdropOpenAnimation: "animate-fade-in-backdrop-fast",
            backdropCloseAnimation: "animate-fade-out-backdrop-fast"
          },
          dark: {
            font: 'font-["-apple-system",_"BlinkMacSystemFont",_"Segoe_UI",_"Roboto",_"Helvetica_Neue",_"Arial",_"Noto_Sans",_sans-serif]',
            pageBg: "bg-black", 
            cardBg: "bg-[#1c1c1e]",
            cardRounding: "rounded-xl",
            cardShadow: "shadow-sm shadow-black/10",
            headerFont: "text-4xl font-bold",
            settingsButton: "p-2 rounded-lg hover:bg-gray-800/70",
            iconStrokeWidth: 2,
            primaryText: "text-gray-100",
            secondaryText: "text-gray-500", 
            secondarySubtle: "text-gray-500",
            tertiaryBg: "bg-gray-800/70",
            dividerColor: "bg-gray-700",
            inputColor: "text-gray-400",
            actionColor: "text-blue-400",
            activeSegmentBg: "bg-black",
            iconBgRed: "bg-red-900/50",
            iconColorRed: "text-red-400",
            iconBgGreen: "bg-green-900/50",
            iconColorGreen: "text-green-400",
            modalBg: "bg-[#1c1c1e]/80 backdrop-blur-xl",
            modalRounding: "rounded-t-xl",
            modalShadow: "shadow-lg shadow-black/20",
            modalOpenAnimation: "animate-slide-up-cupertino",
            modalCloseAnimation: "animate-slide-down-cupertino",
            backdropOpenAnimation: "animate-fade-in-backdrop-fast",
            backdropCloseAnimation: "animate-fade-out-backdrop-fast"
          }
        },
        material: {
          light: {
            font: 'font-["Roboto",_"Noto_Sans",_sans-serif]',
            pageBg: "bg-[#f8faff]", 
            cardBg: "bg-white",
            cardRounding: "rounded-[28px]", 
            cardShadow: "shadow-lg shadow-gray-300/50",
            headerFont: "text-4xl font-medium",
            iconStrokeWidth: 2.5, 
            primaryText: "text-gray-800",
            secondaryText: "text-gray-600",
            secondarySubtle: "text-gray-500",
            dividerColor: "bg-blue-50", 
            inputColor: "text-gray-600",
            modalBg: "bg-white",
            modalRounding: "rounded-t-[28px]",
            modalShadow: "shadow-2xl",
            modalOpenAnimation: "animate-slide-up-material",
            modalCloseAnimation: "animate-slide-down-material",
            backdropOpenAnimation: "animate-fade-in-backdrop-slow",
            backdropCloseAnimation: "animate-fade-out-backdrop-slow",
            settingsButton: "p-2 rounded-full hover:bg-blue-100",
            actionColor: "text-blue-800", 
            activeSegmentBg: "bg-blue-100", 
            iconColorPrimary: "text-blue-700",
            iconBgPrimary: "bg-blue-100",
            iconColorSuccess: "text-green-800",
            iconBgSuccess: "bg-green-100",
            iconColorError: "text-red-800",
            iconBgError: "bg-red-100",
            widgetBgNeutral: "bg-gray-100",
            widgetTextNeutral: "text-gray-800",
            widgetBgSecondary: "bg-purple-100",
            widgetTextSecondary: "text-purple-800",
            tertiaryBg: "bg-blue-50"
          },
          dark: {
            font: 'font-["Roboto",_"Noto_Sans",_sans-serif]',
            // --- UPDATED Dark Theme Colors ---
            pageBg: "bg-[#222327]", // User-defined page background
            cardBg: "bg-[#282a2c]", // User-defined card background
            cardRounding: "rounded-[28px]",
            cardShadow: "shadow-xl shadow-black/30",
            headerFont: "text-4xl font-medium",
            iconStrokeWidth: 2.5,
            primaryText: "text-gray-200",
            secondaryText: "text-gray-400",
            secondarySubtle: "text-gray-500",
            dividerColor: "bg-[#373a3d]", // Adjusted for new card color
            inputColor: "text-gray-400",
            modalBg: "bg-[#282a2c]", // Match card
            modalRounding: "rounded-t-[28px]",
            modalShadow: "shadow-2xl shadow-black/40",
            modalOpenAnimation: "animate-slide-up-material",
            modalCloseAnimation: "animate-slide-down-material",
            backdropOpenAnimation: "animate-fade-in-backdrop-slow",
            backdropCloseAnimation: "animate-fade-out-backdrop-slow",
            settingsButton: "p-2 rounded-full hover:bg-blue-900/50",
            actionColor: "text-blue-300", 
            activeSegmentBg: "bg-blue-900/60", 
            iconColorPrimary: "text-blue-300",
            iconBgPrimary: "bg-blue-900/50",
            iconColorSuccess: "text-green-300",
            iconBgSuccess: "bg-green-900/50",
            iconColorError: "text-red-300",
            iconBgError: "bg-red-900/50",
            widgetBgNeutral: "bg-[#373a3d]", // Adjusted for new card color
            widgetTextNeutral: "text-gray-200",
            widgetBgSecondary: "bg-purple-900/50",
            widgetTextSecondary: "text-purple-200",
            tertiaryBg: "bg-[#1e1f22]" // Adjusted for new page color
          }
        }
      };
      return themes[design][isDarkMode ? 'dark' : 'light'];
    };

// --- Reusable Components ---

    function SegmentedControl({ options, value, onChange, design, theme }) {
      const activeIndex = useMemo(() => options.findIndex(o => o.value === value), [options, value]);
      const itemWidth = 100 / options.length;

      if (design === 'cupertino') {
        const totalPadding = 4;
        return (
          <div className={`relative flex w-full ${theme.tertiaryBg} rounded-lg p-[2px]`}>
            <div
              className={`absolute top-[2px] bottom-[2px] left-[2px] ${theme.activeSegmentBg} rounded-md shadow transition-all duration-300 ease-in-out`}
              style={{
                width: `calc(${itemWidth}% - ${totalPadding / options.length}px)`, 
                transform: `translateX(calc(${activeIndex * 100}%))`, 
              }}
            />
            {options.map((option) => (
              <button
                key={option.value}
                onClick={() => onChange(option.value)}
                className={`relative z-10 flex-1 py-2 rounded-md font-medium text-xs transition-colors duration-200 ${
                  value === option.value ? theme.actionColor : theme.secondaryText
                }`}
              >
                {option.label}
              </button>
            ))}
          </div>
        );
      }

      if (design === 'material') {
        const totalPadding = 8;
        return (
          <div className={`relative flex w-full ${theme.tertiaryBg} rounded-full p-1`}>
            <div
              className={`absolute top-1 bottom-1 left-1 ${theme.activeSegmentBg} rounded-full shadow-md transition-all duration-300 ease-in-out`} 
              style={{
                width: `calc(${itemWidth}% - ${totalPadding / options.length}px)`, 
                transform: `translateX(${activeIndex * 100}%)`, 
              }}
            />
            {options.map((option) => (
              <button
                key={option.value}
                onClick={() => onChange(option.value)}
                className={`relative z-10 flex-1 py-2 font-medium text-xs transition-colors duration-200 rounded-full ${
                  value === option.value ? theme.actionColor : theme.secondaryText
                }`}
              >
                {option.label}
              </button>
            ))}
          </div>
        );
      }
      return null;
    }

    function Divider({ design, theme }) {
      if (design === 'cupertino') {
        return (
          <div className="w-full pl-4">
            <div className={`h-px w-full ${theme.dividerColor}`}></div>
          </div>
        );
      }
      return <div className={`h-px w-full ${theme.dividerColor}`}></div>;
    }

    function SettingsModal({ isOpen, onClose, isMobile, theme, design, setDesign, mode, setMode }) {
      const [isClosing, setIsClosing] = useState(false);
      const animationDuration = design === 'material' ? 400 : 350;

      const handleClose = () => {
        setIsClosing(true);
        setTimeout(() => {
          onClose();
          setIsClosing(false);
        }, animationDuration);
      };

      if (!isOpen) return null;

      const modalStyle = isMobile ?
        `fixed bottom-0 left-0 right-0 w-full p-4 pt-6 ${theme.modalBg} ${theme.modalRounding} ${theme.modalShadow} ${isClosing ? theme.modalCloseAnimation : theme.modalOpenAnimation}` :
        `absolute top-24 right-4 md:right-8 w-80 p-4 ${theme.cardBg} ${theme.modalRounding} ${theme.modalShadow} ${isClosing ? 'animate-fade-out-popover' : 'animate-fade-in-popover'}`;
      
      const backdropStyle = `fixed inset-0 bg-black/30 backdrop-blur-sm z-40 ${isClosing ? theme.backdropCloseAnimation : theme.backdropOpenAnimation}`;

      const appearanceOptions = [ { value: 'light', label: 'Light' }, { value: 'dark', label: 'Dark' }, { value: 'system', label: 'System' } ];
      const designOptions = [ { value: 'cupertino', label: 'Cupertino' }, { value: 'material', label: 'Material You' } ];

      return (
        <div>
          <div className={backdropStyle} onClick={handleClose}></div>
          <div className={`z-50 ${modalStyle}`}>
            {isMobile && (
              <div className={`w-10 h-1 ${theme.tertiaryBg} rounded-full absolute top-2.5 left-1/2 -translate-x-1/2`}></div>
            )}
            <div className="space-y-4 pt-2">
              <div>
                <label className={`text-sm font-medium ${theme.primaryText} mb-2 block px-2`}>Appearance</label>
                <SegmentedControl options={appearanceOptions} value={mode} onChange={setMode} design={design} theme={theme} />
              </div>
              <div>
                <label className={`text-sm font-medium ${theme.primaryText} mb-2 block px-2`}>Design</label>
                <SegmentedControl options={designOptions} value={design} onChange={setDesign} design={design} theme={theme} />
              </div>
            </div>
          </div>
        </div>
      );
    }


    // --- Main Application Component ---
    function AttendanceCalculator() {
      // App State
      const [inputMode, setInputMode] = useState('attendedMissed');
      const [totalClasses, setTotalClasses] = useState('');
      const [classesAttended, setClassesAttended] = useState('');
      const [classesMissed, setClassesMissed] = useState('');
      const [stats, setStats] = useState(null);
      const [errorMessage, setErrorMessage] = useState(null);
      
      // Theme State
      const [design, setDesign] = useState('cupertino');
      const [mode, setMode] = useState('system');
      const [isDarkMode, setIsDarkMode] = useState(false);
      const [isSettingsOpen, setIsSettingsOpen] = useState(false);
      const [isMobile, setIsMobile] = useState(false);

      // Theme Logic
      useEffect(() => {
        const checkMobile = () => setIsMobile(window.innerWidth < 768);
        checkMobile();
        window.addEventListener('resize', checkMobile);
        return () => window.removeEventListener('resize', checkMobile);
      }, []);

      useEffect(() => {
        if (mode === 'system') {
          const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
          setIsDarkMode(mediaQuery.matches);
          const handler = (e) => setIsDarkMode(e.matches);
          mediaQuery.addEventListener('change', handler);
          return () => mediaQuery.removeEventListener('change', handler);
        } else {
          setIsDarkMode(mode === 'dark');
        }
      }, [mode]);

      const theme = getThemeClasses(design, isDarkMode);

      // Sarcasm Messages
      const sarcasticMessages = [ "Attended more classes than exist? Are you a time traveler?", "Missed more classes than the total? Impressive, in a weird way.", "Ah, negative classes. Did you *un-learn* something?", "Your math is... creative. Let's try real numbers.", ];
      const getRandomSarcasticMessage = () => sarcasticMessages[Math.floor(Math.random() * sarcasticMessages.length)];
      const floatMessages = [ "Oh, 0.5 of a class? Did the professor just... dissolve?", "Fractional classes? Is this quantum mechanics?", "I only speak in whole numbers. This .1, .2, .3 stuff is too advanced.", ];
      const getRandomFloatMessage = () => floatMessages[Math.floor(Math.random() * floatMessages.length)];

      // CALCULATION LOGIC
      useEffect(() => {
        setErrorMessage(null);
        setStats(null); 
        
        const inputs = [totalClasses, classesAttended, classesMissed];
        if (inputs.some(val => val && val.includes('.'))) { setErrorMessage(getRandomFloatMessage()); return; }
        
        let total = 0, attended = 0, missed = 0;
        const in_total = parseInt(totalClasses);
        const in_attended = parseInt(classesAttended);
        const in_missed = parseInt(classesMissed);
        
        try {
          if (inputMode === 'totalAttended') {
            if ((totalClasses && isNaN(in_total)) || (classesAttended && isNaN(in_attended))) { setErrorMessage(getRandomSarcasticMessage()); return; }
            total = in_total || 0;
            attended = in_attended || 0;
            if (attended < 0 || total < 0) { setErrorMessage("Negative classes? Really?"); return; }
            if (attended > total && total > 0) { setErrorMessage("Attended more classes than exist? Time traveler?"); return; }
            missed = total - attended;
            if (total > 0 && attended >= 0) setClassesMissed(String(missed));
          } else if (inputMode === 'totalMissed') {
            if ((totalClasses && isNaN(in_total)) || (classesMissed && isNaN(in_missed))) { setErrorMessage(getRandomSarcasticMessage()); return; }
            total = in_total || 0;
            missed = in_missed || 0;
            if (missed < 0 || total < 0) { setErrorMessage("Negative classes? Really?"); return; }
            if (missed > total && total > 0) { setErrorMessage("Missed more classes than the total? Impressive."); return; }
            attended = total - missed;
            if (total > 0 && missed >= 0) setClassesAttended(String(attended));
          } else if (inputMode === 'attendedMissed') {
            if ((classesAttended && isNaN(in_attended)) || (classesMissed && isNaN(in_missed))) { setErrorMessage(getRandomSarcasticMessage()); return; }
            attended = in_attended || 0;
            missed = in_missed || 0;
            if (attended < 0 || missed < 0) { setErrorMessage("Negative classes? Really?"); return; }
            total = attended + missed;
            if (attended >= 0 && missed >= 0) setTotalClasses(String(total));
          }
        } catch (error) { setErrorMessage(getRandomSarcasticMessage()); return; }
        
        if (total <= 0 || attended < 0 || missed < 0) { return; }
        
        const currentPercentage = (attended / total) * 100;
        let classesToAttend = 0;
        if (currentPercentage < 75) { classesToAttend = Math.ceil((0.75 * total - attended) / 0.25); }
        let canMiss = 0;
        if (currentPercentage >= 75) { canMiss = Math.floor((attended - 0.75 * total) / 0.75); }
        
        // --- "Next Step" Calculations ---
        const totalAfterBunk = total + 1;
        const attendedAfterBunk = attended;
        const bunkPct = (attendedAfterBunk / totalAfterBunk) * 100;
        let classesToRecover = 0;
        if (bunkPct < 75) {
          classesToRecover = Math.ceil((0.75 * totalAfterBunk - attendedAfterBunk) / 0.25);
        }

        const totalAfterAttend = total + 1;
        const attendedAfterAttend = attended + 1;
        const attendPct = (attendedAfterAttend / totalAfterAttend) * 100;
        let classesCanMiss = 0;
        if (attendPct >= 75) {
          classesCanMiss = Math.floor((attendedAfterAttend - 0.75 * totalAfterAttend) / 0.75);
        }
        
        const newStats = { 
          total, attended, missed, 
          // --- UPDATED: Use Math.round() ---
          currentPercentage: Math.round(currentPercentage), 
          classesToAttend, 
          canMiss: Math.max(0, canMiss), 
          bunkPct: Math.round(bunkPct),
          classesToRecover,
          attendPct: Math.round(attendPct),
          classesCanMiss
        };
        
        setStats(newStats);

      }, [totalClasses, classesAttended, classesMissed, inputMode]);
      
      const inputOptions = [ { value: 'totalAttended', label: 'Total & Attended' }, { value: 'totalMissed', label: 'Total & Missed' }, { value: 'attendedMissed', label: 'Attended & Missed' } ];
      const getStatusColor = (percentage) => { if (percentage >= 75) return 'text-green-500'; if (percentage >= 65) return 'text-yellow-500'; return 'text-red-500'; };
      const getStatusMessage = (percentage) => { if (percentage >= 85) return 'Excellent!'; if (percentage >= 75) return 'Safe Zone'; if (percentage < 75) return 'Action Needed'; return 'In Danger'; };

      // --- Result Content Components ---
      
      const StatsCardContent = ({ stats, getStatusColor, getStatusMessage, theme, design, showBreakdownRow = true }) => {
        const iconBgError = design === 'material' ? theme.iconBgError : theme.iconBgRed;
        const iconColorError = design === 'material' ? theme.iconColorError : theme.iconColorRed;
        const iconBgSuccess = design ==='material' ? theme.iconBgSuccess : theme.iconBgGreen;
        const iconColorSuccess = design ==='material' ? theme.iconColorSuccess : theme.iconColorGreen;
        
        return (
          <React.Fragment>
            <div className="p-4 flex items-center justify-between">
              <span className={`${theme.primaryText} font-medium`}>Current Status</span>
              <div className="text-right">
                <span className={`text-3xl font-bold ${getStatusColor(stats.currentPercentage)}`}>
                  {stats.currentPercentage}%
                </span>
                <div className={`text-sm ${theme.secondaryText}`}>{getStatusMessage(stats.currentPercentage)}</div>
              </div>
            </div>

            <Divider design={design} theme={theme} />
            
            <div className="p-4">
              <div className={`relative w-full ${design === 'material' ? theme.tertiaryBg : theme.tertiaryBg} rounded-full h-2.5`}>
                <div
                  className="h-2.5 rounded-full transition-all duration-500"
                  style={{
                      width: `${stats.currentPercentage}%`,
                      backgroundColor: stats.currentPercentage >= 75 ? '#22c55e' : (stats.currentPercentage >= 65 ? '#f59e0b' : '#ef4444'),
                  }}
                />
                <div className="absolute top-[-4px] bottom-[-4px] w-0.5 bg-gray-400" style={{ left: '75%' }} title="75% Target" ></div>
              </div>
              <div className={`relative w-full text-xs ${theme.secondarySubtle} mt-1.5`}>
                <div className="absolute" style={{ left: '75%', transform: 'translateX(-50%)' }}>
                  75%
                </div>
              </div>
            </div>

            <Divider design={design} theme={theme} />

            {stats.currentPercentage < 75 ? (
              <div className="p-4 flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className={`flex-shrink-0 w-8 h-8 flex items-center justify-center ${iconBgError} rounded-lg`}>
                    <Target c={iconColorError} s={16} sw={theme.iconStrokeWidth} />
                  </div>
                  <div>
                    <div className={theme.primaryText}>Classes to Attend</div>
                    <div className={`text-xs ${theme.secondarySubtle}`}>To reach 75% goal</div>
                  </div>
                </div>
                <span className={`text-xl font-medium ${iconColorError}`}>
                  {stats.classesToAttend} {stats.classesToAttend === 1 ? 'class' : 'classes'}
                </span>
              </div>
            ) : (
              <div className="p-4 flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className={`flex-shrink-0 w-8 h-8 flex items-center justify-center ${iconBgSuccess} rounded-lg`}>
                    <Sparkles c={iconColorSuccess} s={16} sw={theme.iconStrokeWidth} />
                  </div>
                  <div>
                    <div className={theme.primaryText}>Safe to Miss</div>
                    <div className={`text-xs ${theme.secondarySubtle}`}>To stay above 75%</div>
                  </div>
                </div>
                <span className={`text-xl font-medium ${iconColorSuccess}`}>
                  {stats.canMiss} {stats.canMiss === 1 ? 'class' : 'classes'}
                </span>
              </div>
            )}

            {showBreakdownRow && (
              <React.Fragment>
                <Divider design={design} theme={theme} />
                <div className="p-4 flex items-center justify-between">
                  <span className={theme.primaryText}>Breakdown</span>
                  <div className={`text-right text-sm ${theme.secondaryText}`}>
                    <span className="font-medium text-green-600">{stats.attended}</span> Present / 
                    <span className="font-medium text-red-600"> {stats.missed}</span> Absent / 
                    <span className={`font-medium ${theme.primaryText}`}> {stats.total}</span> Total
                  </div>
                </div>
              </React.Fragment>
            )}
          </React.Fragment>
        );
      }
      
      const MaterialStatChip = ({ label, value, bgColorClass, fgColorClass }) => (
        <div className={`flex-1 p-3 rounded-2xl ${bgColorClass}`}>
          <div className={`text-xs ${fgColorClass} opacity-80`}>{label}</div>
          <div className={`text-xl font-medium ${fgColorClass}`}>
            {value}
          </div>
        </div>
      );
      
      const MaterialBreakdownWidget = ({ stats, theme }) => (
        <div className={`${theme.cardBg} ${theme.cardRounding} ${theme.cardShadow} overflow-hidden p-4`}>
          <h3 className={`${theme.primaryText} text-sm font-medium pb-2`}>
            Breakdown
          </h3>
          <div className="flex flex-row gap-3">
            <MaterialStatChip 
              label="Present" 
              value={stats.attended} 
              bgColorClass={theme.iconBgSuccess}
              fgColorClass={theme.iconColorSuccess}
            />
            <MaterialStatChip 
              label="Absent" 
              value={stats.missed} 
              bgColorClass={theme.iconBgError}
              fgColorClass={theme.iconColorError}
            />
            <MaterialStatChip 
              label="Total" 
              value={stats.total} 
              bgColorClass={theme.widgetBgNeutral}
              fgColorClass={theme.widgetTextNeutral}
            />
          </div>
        </div>
      );
      
      // --- "Next Step" Projection Components ---

      const NextStepProjections = ({ stats, theme, design }) => {
        const isCupertino = design === 'cupertino';
        
        // Helper to format class text
        const classText = (count) => count === 1 ? 'class' : 'classes';

        if (isCupertino) {
          return (
            <div className={`${theme.cardBg} ${theme.cardRounding} ${theme.cardShadow} overflow-hidden`}>
              <h3 className={`${theme.primaryText} font-medium p-4`}>
                Next Step
              </h3>
              <Divider design={design} theme={theme} />
              
              {/* Bunk Scenario */}
              <div className="p-4 flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className={`flex-shrink-0 w-8 h-8 flex items-center justify-center ${theme.iconBgRed} rounded-lg`}>
                    <ArrowDownRight c={theme.iconColorRed} s={16} sw={theme.iconStrokeWidth} />
                  </div>
                  <div>
                    <div className={theme.primaryText}>If you BUNK next class</div>
                    <div className={`text-xs ${theme.secondarySubtle}`}>
                      {stats.classesToRecover > 0 ? 
                        `Recovery: ${stats.classesToRecover} ${classText(stats.classesToRecover)}` : 
                        `You'll be safe`}
                    </div>
                  </div>
                </div>
                <span className="text-xl font-medium text-red-600">
                  {stats.bunkPct}%
                </span>
              </div>
              
              <Divider design={design} theme={theme} />
              
              {/* Attend Scenario */}
              <div className="p-4 flex items-center justify-between">
                <div className="flex items-center space-x-3">
                  <div className={`flex-shrink-0 w-8 h-8 flex items-center justify-center ${theme.iconBgGreen} rounded-lg`}>
                    <ArrowUpRight c={theme.iconColorGreen} s={16} sw={theme.iconStrokeWidth} />
                  </div>
                  <div>
                    <div className={theme.primaryText}>If you ATTEND next class</div>
                    <div className={`text-xs ${theme.secondarySubtle}`}>
                      {stats.classesCanMiss > 0 ? 
                        `Margin: ${stats.classesCanMiss} ${classText(stats.classesCanMiss)}` : 
                        `Still in danger`}
                    </div>
                  </div>
                </div>
                <span className="text-xl font-medium text-green-600">
                  {stats.attendPct}%
                </span>
              </div>
            </div>
          );
        }

        // Material You Style
        return (
          <div className={`${theme.cardBg} ${theme.cardRounding} ${theme.cardShadow} overflow-hidden p-4`}>
            <h3 className={`${theme.primaryText} text-sm font-medium pb-2`}>
              Next Step
            </h3>
            <div className="flex flex-col sm:flex-row gap-3">
              {/* Bunk Widget */}
              <div className={`flex-1 p-4 rounded-2xl ${theme.iconBgError}`}>
                <div className={`text-sm ${theme.iconColorError} opacity-90`}>If you BUNK 1 class</div>
                <div className={`text-3xl font-medium ${theme.iconColorError}`}>
                  {stats.bunkPct}%
                </div>
                <div className={`text-xs ${theme.iconColorError} opacity-80 mt-1`}>
                  {stats.classesToRecover > 0 ? 
                    `Recovery: ${stats.classesToRecover} ${classText(stats.classesToRecover)}` : 
                    `You'll be safe`}
                </div>
              </div>
              {/* Attend Widget */}
              <div className={`flex-1 p-4 rounded-2xl ${theme.iconBgSuccess}`}>
                <div className={`text-sm ${theme.iconColorSuccess} opacity-90`}>If you ATTEND 1 class</div>
                <div className={`text-3xl font-medium ${theme.iconColorSuccess}`}>
                  {stats.attendPct}%
                </div>
                <div className={`text-xs ${theme.iconColorSuccess} opacity-80 mt-1`}>
                  {stats.classesCanMiss > 0 ? 
                    `Margin: ${stats.classesCanMiss} ${classText(stats.classesCanMiss)}` : 
                    `Still in danger`}
                </div>
              </div>
            </div>
          </div>
        );
      };


      // --- RENDER ---
      return (
        <div className={`min-h-screen p-4 ${theme.pageBg} ${theme.font} transition-colors duration-300 ${design}`}>
          <style>{`
            /* Animations (Unchanged) */
            @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
            .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
            @keyframes popoverIn { from { opacity: 0; transform: scale(0.95) translateY(-10px); } to { opacity: 1; transform: scale(1) translateY(0); } }
            .animate-fade-in-popover { animation: popoverIn 0.2s ease-out forwards; transform-origin: top right; }
            @keyframes popoverOut { from { opacity: 1; transform: scale(1); } to { opacity: 0; transform: scale(0.95) translateY(-10px); } }
            .animate-fade-out-popover { animation: popoverOut 0.2s ease-in forwards; transform-origin: top right; }
            @keyframes fadeInBackdropFast { from { opacity: 0; } to { opacity: 1; } }
            .animate-fade-in-backdrop-fast { animation: fadeInBackdropFast 0.2s ease-out forwards; }
            @keyframes fadeOutBackdropFast { from { opacity: 1; } to { opacity: 0; } }
            .animate-fade-out-backdrop-fast { animation: fadeOutBackdropFast 0.3s ease-in forwards; }
            @keyframes fadeInBackdropSlow { from { opacity: 0; } to { opacity: 1; } }
            .animate-fade-in-backdrop-slow { animation: fadeInBackdropSlow 0.3s ease-in-out forwards; }
            @keyframes fadeOutBackdropSlow { from { opacity: 1; } to { opacity: 0; } }
            .animate-fade-out-backdrop-slow { animation: fadeOutBackdropSlow 0.3s ease-in-out forwards; }
            @keyframes slideUpCupertino { from { transform: translateY(100%); } to { transform: translateY(0); } }
            .animate-slide-up-cupertino { animation: slideUpCupertino 0.35s cubic-bezier(0.32, 0.72, 0, 1) forwards; }
            @keyframes slideDownCupertino { from { transform: translateY(0); } to { transform: translateY(100%); } }
            .animate-slide-down-cupertino { animation: slideDownCupertino 0.35s cubic-bezier(0.32, 0.72, 0, 1) forwards; }
            @keyframes slideUpMaterial { from { opacity: 0; transform: translateY(100%); } to { opacity: 1; transform: translateY(0); } }
            .animate-slide-up-material { animation: slideUpMaterial 0.4s cubic-bezier(0.2, 0, 0, 1) forwards; }
            @keyframes slideDownMaterial { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(100%); } }
            .animate-slide-down-material { animation: slideDownMaterial 0.3s cubic-bezier(0.2, 0, 0, 1) forwards; }
            input::-webkit-outer-spin-button, input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
            input[type=number] { -moz-appearance: textfield; }
          `}</style>
          
          <div className="max-w-md md:max-w-xl mx-auto space-y-4">
            
            {/* --- HEADER --- */}
            <header className="px-4 pt-8 pb-4 flex justify-between items-center">
              <h1 className={`${theme.headerFont} ${theme.primaryText} flex items-center gap-3`}>
                {design === 'material' ? (
                  <span className={`p-2 ${theme.iconBgPrimary} rounded-lg`}>
                    <Calendar c={theme.iconColorPrimary} s={28} sw={theme.iconStrokeWidth} />
                  </span>
                ) : (
                  <Calendar c={theme.actionColor} s={34} sw={theme.iconStrokeWidth} />
                )}
                Attendance
              </h1>
              <button onClick={() => setIsSettingsOpen(true)} className={`${theme.settingsButton} ${theme.secondaryText}`}>
                <Settings s={22} sw={theme.iconStrokeWidth} />
              </button>
            </header>

            {/* Input Section */}
            <div>
              <h2 className={`text-xs font-semibold ${theme.secondaryText} uppercase px-6 pb-2`}>
                Enter Details
              </h2>
              <div className={`${theme.cardBg} ${theme.cardRounding} ${theme.cardShadow} overflow-hidden`}>
                <div className="p-4">
                  <label className={`text-sm ${theme.primaryText} mb-2 block`}>Data I Have</label>
                  <SegmentedControl options={inputOptions} value={inputMode} onChange={setInputMode} design={design} theme={theme} />
                </div>
                
                <Divider design={design} theme={theme} />
                
                {inputMode === 'totalAttended' && (
                  <>
                    <div className="flex items-center justify-between p-4">
                      <label htmlFor="total-classes" className={theme.primaryText}>Total Classes</label>
                      <input id="total-classes" type="number" value={totalClasses} onChange={(e) => setTotalClasses(e.target.value)} className={`w-24 text-right ${theme.inputColor} bg-transparent border-none focus:ring-0 focus:outline-none p-0`} placeholder="e.g., 50" min="0" />
                    </div>
                    <Divider design={design} theme={theme} />
                    <div className="flex items-center justify-between p-4">
                      <label htmlFor="classes-attended" className={theme.primaryText}>Classes Attended</label>
                      <input id="classes-attended" type="number" value={classesAttended} onChange={(e) => setClassesAttended(e.target.value)} className={`w-24 text-right ${theme.inputColor} bg-transparent border-none focus:ring-0 focus:outline-none p-0`} placeholder="e.g., 40" min="0" />
                    </div>
                  </>
                )}
                {inputMode === 'totalMissed' && (
                  <>
                    <div className="flex items-center justify-between p-4">
                      <label htmlFor="total-classes" className={theme.primaryText}>Total Classes</label>
                      <input id="total-classes" type="number" value={totalClasses} onChange={(e) => setTotalClasses(e.target.value)} className={`w-24 text-right ${theme.inputColor} bg-transparent border-none focus:ring-0 focus:outline-none p-0`} placeholder="e.g., 50" min="0" />
                    </div>
                    <Divider design={design} theme={theme} />
                    <div className="flex items-center justify-between p-4">
                      <label htmlFor="classes-missed" className={theme.primaryText}>Classes Missed</label>
                      <input id="classes-missed" type="number" value={classesMissed} onChange={(e) => setClassesMissed(e.target.value)} className={`w-24 text-right ${theme.inputColor} bg-transparent border-none focus:ring-0 focus:outline-none p-0`} placeholder="e.g., 10" min="0" />
                    </div>
                  </>
                )}
                {inputMode === 'attendedMissed' && (
                  <>
                    <div className="flex items-center justify-between p-4">
                      <label htmlFor="classes-attended" className={theme.primaryText}>Classes Attended</label>

                      <input id="classes-attended" type="number" value={classesAttended} onChange={(e) => setClassesAttended(e.target.value)} className={`w-24 text-right ${theme.inputColor} bg-transparent border-none focus:ring-0 focus:outline-none p-0`} placeholder="e.g., 40" min="0" />
                    </div>
                    <Divider design={design} theme={theme} />
                    <div className="flex items-center justify-between p-4">
                      <label htmlFor="classes-missed" className={theme.primaryText}>Classes Missed</label>
                      <input id="classes-missed" type="number" value={classesMissed} onChange={(e) => setClassesMissed(e.target.value)} className={`w-24 text-right ${theme.inputColor} bg-transparent border-none focus:ring-0 focus:outline-none p-0`} placeholder="e.g., 10" min="0" />
                    </div>
                  </>
                )}
              </div>
            </div>

            {/* Error Message */}
            {errorMessage && (
              <div className="text-center px-6 py-1 text-sm text-red-600 animate-fade-in -mt-2">
                {errorMessage}
              </div>
            )}

            {/* --- RESULTS SECTION --- */}
            {stats && (
              <div className="space-y-4 animate-fade-in">
                
                {/* === Cupertino Layout (List of Groups) === */}
                {design === 'cupertino' && (
                  <React.Fragment>
                    <h2 className={`text-xs font-semibold ${theme.secondaryText} uppercase px-6 pb-2 pt-2`}>
                      Results
                    </h2>
                    <div className={`${theme.cardBg} ${theme.cardRounding} ${theme.cardShadow} overflow-hidden`}>
                      <StatsCardContent 
                        stats={stats} 
                        getStatusColor={getStatusColor} 
                        getStatusMessage={getStatusMessage} 
                        theme={theme} 
                        design={design}
                        showBreakdownRow={true} 
                      />
                    </div>
                    <h2 className={`text-xs font-semibold ${theme.secondaryText} uppercase px-6 pb-2 pt-2`}>
                      Projections
                    </h2>
                    <NextStepProjections
                      stats={stats}
                      theme={theme}
                      design={design}
                    />
                  </React.Fragment>
                )}

                {/* === Material You Layout (Widget Dashboard) === */}
                {design === 'material' && (
                  <React.Fragment>
                    <div className="pt-2"></div> 
                    
                    <div className={`${theme.cardBg} ${theme.cardRounding} ${theme.cardShadow} overflow-hidden`}>
                      <StatsCardContent 
                        stats={stats} 
                        getStatusColor={getStatusColor} 
                        getStatusMessage={getStatusMessage} 
                        theme={theme} 
                        design={design}
                        showBreakdownRow={false} 
                      />
                    </div>
                    
                    <MaterialBreakdownWidget stats={stats} theme={theme} />
                    
                    <NextStepProjections
                      stats={stats}
                      theme={theme}
                      design={design}
                    />
                    
                  </React.Fragment>
                )}
              </div>
            )}
            {/* --- END OF REFACTORED RESULTS SECTION --- */}


            {/* Empty State */}
            {!stats && !errorMessage && (
              <div className={`text-center py-20 ${theme.secondarySubtle}`}>
                <ClipboardList c="text-gray-400 mx-auto" s={64} sw={theme.iconStrokeWidth} />
                <p className="mt-4 text-lg">Enter your details</p>
                <p className="text-sm">Your stats will appear here</p>
              </div>
            )}
          </div>
          
          <SettingsModal
            isOpen={isSettingsOpen}
            onClose={() => setIsSettingsOpen(false)}
            isMobile={isMobile}
            theme={theme}
            design={design}
            setDesign={setDesign}
            mode={mode}
            setMode={setMode}
          />
        </div>
      );
    }

    ReactDOM.render(<AttendanceCalculator />, document.getElementById('root'));
  </script>

</body>
</html>
